// Grammar object
const Grammar = {

    "flag": "i",

    "terminals": [
        "0",
        "x",
        "\\[",
        "\\]",
        "\\*",
        "\\(",
        ",",
        "\\)",
        "[2468acegikmoqsuwy]",
        "[13579bdfhjlnprtvz]",
    ],

    "dummies": [
        "\\s+",
    ],

    "rules": [
        "#0#=1",
        "Pattern=1",
        "#1#=1",
        "#1#=1",
        "Async=1",
        "#2#=2",
        "#2#=1",
        "EachHand=1",
        "#3#=1",
        "#3#=1",
        "#3#=1",
        "AsyncSimple=1",
        "#4#=1",
        "#4#=1",
        "#4#=1",
        "Even=1",
        "Odd=1",
        "AsyncMulti=4",
        "#5#=2",
        "#5#=1",
        "Synch=2",
        "#6#=2",
        "#6#=1",
        "#7#=1",
        "#7#=0",
        "BothHand=5",
        "OneHand=1",
        "#8#=1",
        "#8#=1",
        "#8#=1",
        "SynchSimple=2",
        "#9#=1",
        "#9#=0",
        "SynchMulti=4",
        "#10#=2",
        "#10#=1",
    ],

    "table": [
        [ "s7", "s14", "s16", "", "", "s28", "", "", "s11", "s13", "", "g1", "g2", "g3", "g4", "g22", "g6", "g8", "g9", "g10", "g12", "g15", "", "g23", "g24", "", "g46", "", "", "", "", "", "" ],
        [ "", "", "", "", "", "", "", "", "", "", "r0", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "", "", "", "", "", "", "", "", "", "r1", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "", "", "", "", "", "", "", "", "", "r2", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "s7", "s14", "s16", "", "", "", "", "", "s11", "s13", "r4", "", "", "", "", "g5", "g6", "g8", "g9", "g10", "g12", "g15", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "r5", "r5", "r5", "", "", "", "", "", "r5", "r5", "r5", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "r7", "r7", "r7", "", "", "", "", "", "r7", "r7", "r7", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "r8", "r8", "r8", "", "", "", "", "", "r8", "r8", "r8", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "r9", "r9", "r9", "", "", "", "", "", "r9", "r9", "r9", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "r11", "r11", "r11", "r11", "", "", "", "", "r11", "r11", "r11", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "r12", "r12", "r12", "r12", "", "", "", "", "r12", "r12", "r12", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "r15", "r15", "r15", "r15", "", "", "r15", "r15", "r15", "r15", "r15", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "r13", "r13", "r13", "r13", "", "", "", "", "r13", "r13", "r13", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "r16", "r16", "r16", "r16", "", "", "", "", "r16", "r16", "r16", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "r14", "r14", "r14", "r14", "", "", "", "", "r14", "r14", "r14", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "r10", "r10", "r10", "", "", "", "", "", "r10", "r10", "r10", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "s14", "", "", "", "", "", "", "s11", "s13", "", "", "", "", "", "", "", "g17", "g9", "g10", "g12", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "s14", "", "", "", "", "", "", "s11", "s13", "", "", "", "", "", "", "", "g21", "g9", "g10", "g12", "", "g18", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "s14", "", "s19", "", "", "", "", "s11", "s13", "", "", "", "", "", "", "", "g20", "g9", "g10", "g12", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "r17", "r17", "r17", "", "", "", "", "", "r17", "r17", "r17", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "r18", "", "r18", "", "", "", "", "r18", "r18", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "r19", "", "r19", "", "", "", "", "r19", "r19", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "r6", "r6", "r6", "", "", "", "", "", "r6", "r6", "r6", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "", "", "", "", "", "", "", "", "", "r3", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "", "", "", "s26", "s28", "", "", "", "", "r24", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "g25", "g27", "", "", "", "", "", "" ],
        [ "", "", "", "", "", "", "", "", "", "", "r20", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "", "", "", "", "", "", "", "", "", "r23", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "", "", "", "r21", "r21", "", "", "", "", "r21", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "s34", "", "s40", "", "", "", "", "", "s11", "", "", "", "", "", "", "", "", "", "", "g36", "", "", "", "", "", "", "", "g29", "g33", "g35", "", "g39", "" ],
        [ "", "", "", "", "", "", "s30", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "s34", "", "s40", "", "", "", "", "", "s11", "", "", "", "", "", "", "", "", "", "", "g36", "", "", "", "", "", "", "", "g31", "g33", "g35", "", "g39", "" ],
        [ "", "", "", "", "", "", "", "s32", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "", "", "", "r25", "r25", "", "", "", "", "r25", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "", "", "", "", "", "r26", "r26", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "", "", "", "", "", "r27", "r27", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "", "", "", "", "", "r28", "r28", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "s38", "", "r32", "", "", "r32", "r32", "r32", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "g37", "", "" ],
        [ "", "", "", "r30", "", "", "r30", "r30", "r30", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "", "", "r31", "", "", "r31", "r31", "r31", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "", "", "", "", "", "r29", "r29", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "", "", "", "", "", "", "", "s11", "", "", "", "", "", "", "", "", "", "", "g36", "", "", "", "", "", "", "", "", "", "g41", "", "", "" ],
        [ "", "", "", "", "", "", "", "", "s11", "", "", "", "", "", "", "", "", "", "", "g36", "", "", "", "", "", "", "", "", "", "g45", "", "", "g42" ],
        [ "", "", "", "s43", "", "", "", "", "s11", "", "", "", "", "", "", "", "", "", "", "g36", "", "", "", "", "", "", "", "", "", "g44", "", "", "" ],
        [ "", "", "", "", "", "", "r33", "r33", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "", "", "r34", "", "", "", "", "r34", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "", "", "r35", "", "", "", "", "r35", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
        [ "", "", "", "", "r22", "r22", "", "", "", "", "r22", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "" ],
    ],

}

// Syntax converter
const Converter = {

    // Pattern ::= Async | Synch ;
    "Pattern": function(tree) {
        tree.text = tree.children[0].text;
    },

    // Async ::= EachHand+ ;
    "Async": function(tree) {
        tree.text = tree.children.reduce(this._join, "");
    },

    // EachHand ::= '0' | AsyncSimple | AsyncMulti ;
    "EachHand": function(tree) {
        tree.text = tree.children[0].text;
    },

    // AsyncSimple ::= Even | Odd | 'x' ;
    "AsyncSimple": function(tree) {
        tree.text = tree.children[0].text;
    },

    // Even ::= "[2468acegikmoqsuwy]" ;
    "Even": function(tree) {
        tree.text = tree.children[0].text;
    },

    // Odd ::= "[13579bdfhjlnprtvz]" ;
    "Odd": function(tree) {
        tree.text = tree.children[0].text;
    },

    // AsyncMulti ::= '[' AsyncSimple AsyncSimple+ ']' ;
    "AsyncMulti": function(tree) {
        tree.text = tree.children.reduce(this._join, "");
    },

    // Synch ::= BothHand+ '*'? ;
    "Synch": function(tree) {
        tree.text = tree.children.reduce(this._join, "");
    },

    // BothHand ::= '(' OneHand ',' OneHand ')' ;
    "BothHand": function(tree) {
        tree.text = tree.children.reduce(this._join, "");
    },

    // OneHand ::= '0' | SynchSimple | SynchMulti ;
    "OneHand": function(tree) {
        tree.text = tree.children[0].text;
    },

    // SynchSimple ::= Even 'x'? ;
    "SynchSimple": function(tree) {
        tree.text = tree.children.reduce(this._join, "");
    },

    // SynchMulti ::= '[' SynchSimple SynchSimple+ ']' ;
    "SynchMulti": function(tree) {
        tree.text = tree.children.reduce(this._join, "");
    },

    // join the strings
    "_join": function(acc, cur) {
        return acc + cur.text;
    },

}

